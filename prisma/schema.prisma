// Prisma schema for Ad Library
// Designed for PostgreSQL. Run `npx prisma migrate dev` to apply.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // The connection `url` is intentionally omitted here. Configure `DATABASE_URL`
  // in your deployment environment or a root `.env` file so secrets are not
  // committed into source control. Prisma will pick up `DATABASE_URL` from
  // the environment at runtime.
}

model Ad {
  id           String     @id @default(uuid())
  title        String
  description  String?
  platform     Platform
  industry     String?    // free-form industry name
  hookType     String?    // e.g., "Question", "Shock", "Demo"
  ctaType      String?    // e.g., "Learn More", "Buy Now"
  sourceUrl    String     // original video URL
  sourceType   SourceType @default(AUTO) // AUTO | USER_URL | USER_UPLOAD
  originalOwner String?
  published    Boolean    @default(true)
  thumbnail    String?    // cached thumbnail URL
  durationSec  Int?
  tags         Tag[]      @relation("AdTags", references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Tag {
  id    String @id @default(uuid())
  name  String @unique
  ads   Ad[]   @relation("AdTags")
}

model UserSavedAds {
  id     String @id @default(uuid())
  userId String // references existing auth/user table in Nyra
  adId   String
  savedAt DateTime @default(now())

  @@index([userId])
  @@index([adId])
}

enum Platform {
  TIKTOK
  META
  YOUTUBE
}

enum SourceType {
  AUTO
  USER_URL
  USER_UPLOAD
}

enum JobType {
  REPOST
  REFRESH
}

model AdJob {
  id         String   @id @default(uuid())
  adId       String
  type       JobType
  intervalMin Int     @default(1440) // minutes between runs; default: daily
  active     Boolean  @default(true)
  lastRunAt  DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([adId])
}
